{# templates/matching/like_inbox.html #}
{% extends "matching/base.html" %}

{% block title %}é€šçŸ¥ | Match Lite{% endblock %}

{% block content %}
<div class="page-section">

  <h1 class="page-title">é€šçŸ¥</h1>

  {# â‘  æ–°ã—ããƒãƒƒãƒã—ãŸç›¸æ‰‹ #}
  {% if new_matches %}
    <h2 class="section-title">æ–°ã—ããƒãƒƒãƒã—ãŸç›¸æ‰‹</h2>

    {% for item in new_matches %}
      {% with p=item.partner room=item.room %}
      <div class="card notice-card">
        <div class="notice-main">
          <div class="notice-text">
            ğŸ‰ <strong>{{ p.nickname }}</strong> ã•ã‚“ã¨ãƒãƒƒãƒã—ã¾ã—ãŸï¼
          </div>
          <div class="notice-sub">
            å¹´é½¢: {{ p.age_range|default:"æœªè¨­å®š" }} ï¼
            å±…ä½åœ°: {{ p.prefecture|default:"æœªè¨­å®š" }}
          </div>
        </div>

        <div class="notice-actions">
          <a href="{% url 'profile_detail' pk=p.id %}" class="btn-primary btn-sm">
            ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’è¦‹ã‚‹
          </a>

          {% if room %}
            <a href="{% url 'chat_room' room_id=room.id %}" class="btn-ghost btn-sm">
              ãƒãƒ£ãƒƒãƒˆã‚’é–‹ã
            </a>
          {% else %}
            {# ä¸‡ãŒä¸€éƒ¨å±‹ãŒç„¡ã‘ã‚Œã° start_chat ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ #}
            <a href="{% url 'start_chat' pk=p.id %}" class="btn-ghost btn-sm">
              ãƒãƒ£ãƒƒãƒˆã‚’é–‹ã
            </a>
          {% endif %}
        </div>
      </div>
      {% endwith %}
    {% endfor %}
  {% endif %}

  {# â‘¡ ç‰‡æƒ³ã„ã®ã„ã„ã­ä¸€è¦§ï¼ˆä»Šã¾ã§ã®ãƒªã‚¹ãƒˆï¼‰ #}
  <h2 class="section-title">å±Šã„ã¦ã„ã‚‹ã„ã„ã­</h2>
  {% if incoming_likes %}
    <div style="display:flex; flex-direction:column; gap:12px;">
      {% for like in incoming_likes %}
        {% with p=like.from_user %}
        <div style="
            border:1px solid #f3d2e4;
            border-radius:12px;
            padding:10px 12px;
            display:flex;
            align-items:center;
            gap:10px;
            background:#fffdfd;
        ">
          {# ã‚¢ã‚¤ã‚³ãƒ³é¢¨ #}
          {% if p.avatar %}
            <img src="{{ p.avatar.url }}" alt="{{ p.nickname }} ã•ã‚“"
                 style="width:48px;height:48px;border-radius:50%;object-fit:cover;">
          {% else %}
            <div style="
                width:48px;height:48px;border-radius:50%;
                background:#ffe4ef;color:#ff4b8a;
                display:flex;align-items:center;justify-content:center;
                font-weight:bold;
            ">
              {{ p.nickname|first|default:"?" }}
            </div>
          {% endif %}

          <div style="flex:1;">
            <div style="font-weight:600;">
              {{ p.nickname }} ã•ã‚“ ã‹ã‚‰ã„ã„ã­ãŒå±Šãã¾ã—ãŸ
            </div>
            <div style="font-size:12px;color:#777;margin-top:2px;">
              å¹´é½¢: {{ p.age_range|default:"æœªè¨­å®š" }} ï¼
              å±…ä½åœ°: {{ p.prefecture|default:"æœªè¨­å®š" }}
            </div>
          </div>

          <div style="display:flex; flex-direction:column; gap:4px;">
            <a href="{% url 'profile_detail' p.pk %}" class="btn-ghost">
              ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’è¦‹ã‚‹
            </a>
            <a href="{% url 'send_like' p.pk %}" class="btn-primary">
              ã„ã„ã­è¿”ã—ã™ã‚‹
            </a>
          </div>
        </div>
        {% endwith %}
      {% endfor %}
    </div>
  {% else %}
    <p style="font-size:14px;color:#777;margin-top:8px;">
      ã¾ã æ–°ã—ã„ã€Œã„ã„ã­ã€ã¯å±Šã„ã¦ã„ã¾ã›ã‚“ã€‚<br>
      ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¸€è¦§ã‹ã‚‰æ°—ã«ãªã‚‹äººã«ã„ã„ã­ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
    </p>
  {% endif %}
</div>
{% endblock %}
