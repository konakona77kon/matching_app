{% extends "matching/base.html" %}

{% block title %}{{ profile.nickname|default:"ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ æœªè¨­å®š" }}ã•ã‚“ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« | Match Lite{% endblock %}

{% block extra_css %}
<style>
  .profile-page {
      max-width: 720px;
      margin: 0 auto;
  }

  .profile-card-main {
      border-radius: 20px;
      box-shadow: 0 14px 35px rgba(255, 137, 184, 0.18);
      overflow: hidden;
      padding: 0;
  }

  /* ä¸Šã®å¤§ãã„å†™çœŸã‚¨ãƒªã‚¢ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼‰ */
  .profile-hero {
      background: #f3f3f3;
      padding: 16px 0;
      display: flex;
      justify-content: center;
  }

  .photo-slider {
      position: relative;
      width: 100%;
      max-width: 320px;
      margin: 0 auto;
      aspect-ratio: 9 / 16;  /* ã‚¹ãƒãƒ›ç¸¦ç”»é¢ã£ã½ã„æ¯”ç‡ */
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      background: #e9e9e9;
  }

  .photo-strip {
      display: flex;
      height: 100%;
      width: 100%;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
  }
  .photo-strip::-webkit-scrollbar {
      display: none;
  }

  .photo-slide {
      flex: 0 0 100%;
      height: 100%;
      scroll-snap-align: center;
      position: relative;
  }

  .photo-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
  }

  .photo-slide-placeholder {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      color: #ff6f9b;
      font-weight: 600;
  }

  /* å·¦å³ã®çŸ¢å°ãƒœã‚¿ãƒ³ */
  .photo-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      background: rgba(255, 255, 255, 0.8);
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      padding: 0;
  }
  .photo-arrow.left {
      left: 8px;
  }
  .photo-arrow.right {
      right: 8px;
  }
  .photo-arrow:disabled {
      opacity: 0.4;
      cursor: default;
      box-shadow: none;
  }

  .profile-body {
      padding: 16px 22px 20px;
  }

  .profile-name-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 4px;
  }

  .profile-name {
      font-size: 20px;
      font-weight: 700;
  }

  .profile-meta {
      font-size: 13px;
      color: #777;
      margin-bottom: 4px;
  }

  .profile-tags-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
  }

  .profile-tag {
      display: inline-block;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #ffe4ef;
      color: #ff6f9b;
  }

  .profile-comment-title {
      font-size: 13px;
      font-weight: 600;
      margin-top: 8px;
      margin-bottom: 4px;
  }

  .profile-comment {
      font-size: 13px;
      line-height: 1.6;
      color: #555;
  }

  .profile-subinfo {
      margin-top: 12px;
      font-size: 12px;
      color: #666;
  }

  .profile-subinfo-row {
      margin-top: 2px;
  }

  .profile-actions-row {
      display: flex;
      gap: 12px;
      margin-top: 16px;
      flex-wrap: wrap;
  }

  .profile-actions-row .btn-primary,
  .profile-actions-row .btn-ghost,
  .profile-actions-row .btn-outline {
      flex: 1;
      text-align: center;
  }

  .btn-outline {
      display: inline-block;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid var(--pink);
      color: var(--pink-strong);
      text-decoration: none;
      font-size: 14px;
      background: #fff;
      cursor: pointer;
  }

  .btn-outline:hover {
      background: var(--pink-light);
  }

  .profile-footer-nav {
      margin-top: 14px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
  }

  @media (max-width: 768px) {
      .profile-body {
          padding: 14px 14px 18px;
      }
  }
</style>
{% endblock %}

{% block content %}
<div class="profile-page">
  <div class="card profile-card-main">

    {# ä¸Šã®å¤§ãã„ç”»åƒã‚¨ãƒªã‚¢ï¼šãƒ¡ã‚¤ãƒ³ï¼‹ã‚µãƒ–ã‚’ã¾ã¨ã‚ã¦ã‚¹ãƒ©ã‚¤ãƒ‰è¡¨ç¤º #}
    <div class="profile-hero">
      <div class="photo-slider">
        <div class="photo-strip" id="photo-strip">
          {# ã‚¹ãƒ©ã‚¤ãƒ‰1æšç›®ï¼šãƒ¡ã‚¤ãƒ³å†™çœŸ or ã‚¤ãƒ‹ã‚·ãƒ£ãƒ« #}
          {% if profile.avatar %}
            <div class="photo-slide">
              <img src="{{ profile.avatar.url }}" alt="{{ profile.nickname }} ã•ã‚“ã®å†™çœŸ">
            </div>
          {% else %}
            <div class="photo-slide photo-slide-placeholder">
              {{ profile.nickname|first|default:"?" }}
            </div>
          {% endif %}

          {# ã‚µãƒ–å†™çœŸãŒã‚ã‚Œã°ç¶šã‘ã¦ã‚¹ãƒ©ã‚¤ãƒ‰ã«è¿½åŠ  #}
          {% if photos %}
            {% for p in photos %}
              {% if p.image %}
                <div class="photo-slide">
                  <img src="{{ p.image.url }}" alt="photo">
                </div>
              {% endif %}
            {% endfor %}
          {% endif %}
        </div>

        {# çŸ¢å° #}
        <button class="photo-arrow left" type="button" data-direction="-1">â€¹</button>
        <button class="photo-arrow right" type="button" data-direction="1">â€º</button>
      </div>
    </div>

    {# ä¸‹å´ã®æƒ…å ±ã‚¨ãƒªã‚¢ #}
    <div class="profile-body">
      <div class="profile-name-row">
        <div class="profile-name">{{ profile.nickname|default:"ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ æœªè¨­å®š" }}</div>

        <div class="profile-meta">
          {% if profile.age_range %}
            {{ profile.age_range }}
          {% else %}
            å¹´é½¢æœªè¨­å®š
          {% endif %}
          ãƒ»
          {{ profile.prefecture|default:"å±…ä½åœ°æœªè¨­å®š" }}
        </div>

        {# â˜… ã‚¿ã‚°è¡Œï¼šè·æ¥­ãƒ»åˆ©ç”¨ç›®çš„ãªã©ã‚’å°ã•ãªã‚¿ã‚°ã§è¡¨ç¤º #}
        <div class="profile-tags-row">
          {% if profile.job %}
            <span class="profile-tag">{{ profile.job }}</span>
          {% endif %}
          {% if profile.purpose %}
            <span class="profile-tag">{{ profile.purpose }}</span>
          {% endif %}
        </div>
      </div>

      <div class="profile-comment-title">è‡ªå·±ç´¹ä»‹</div>
      <div class="profile-comment">
        {% if profile.bio %}
          {{ profile.bio|linebreaksbr }}
        {% else %}
          ã¾ã ã²ã¨ã“ã¨ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
        {% endif %}
      </div>

      <div class="profile-subinfo">
        <div class="profile-subinfo-row">
          æ€§åˆ¥: {{ profile.get_gender_display|default:"æœªè¨­å®š" }}
        </div>
        <div class="profile-subinfo-row">
          å¹´å:
          {% if profile.income %}
            ç´„ {{ profile.income }} ä¸‡å††
          {% else %}
            æœªè¨­å®š
          {% endif %}
        </div>
        {# â˜… è·æ¥­ã‚’ãƒ†ã‚­ã‚¹ãƒˆã§ã‚‚è¡¨ç¤º #}
        <div class="profile-subinfo-row">
          è·æ¥­:
          {% if profile.job %}
            {{ profile.job }}
          {% else %}
            æœªè¨­å®š
          {% endif %}
        </div>
        {# â˜… åˆ©ç”¨ç›®çš„ã‚’ãƒ†ã‚­ã‚¹ãƒˆã§ã‚‚è¡¨ç¤º #}
<div class="profile-subinfo-row">
  åˆ©ç”¨ç›®çš„:
  {% if profile.purpose %}
    {{ profile.get_purpose_display }}
  {% else %}
    æœªè¨­å®š
  {% endif %}
</div>


      {# ãƒœã‚¿ãƒ³è¡Œï¼ˆã„ã„ã­ / ãƒãƒ£ãƒƒãƒˆï¼‰ #}
      <div class="profile-actions-row">
        {% if me and profile.id == me.id %}
          <a href="{% url 'edit_my_profile' %}" class="btn-primary">
            âœï¸ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç·¨é›†ã™ã‚‹
          </a>
        {% else %}

          {# â˜… ãƒ–ãƒ­ãƒƒã‚¯ä¸­ã¯ã„ã„ã­/ãƒãƒ£ãƒƒãƒˆã‚’å‡ºã•ãªã„ #}
          {% if is_blocked %}
            <div style="font-size:12px; color:#c0392b; text-align:center; width:100%;">
              ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã¯ãƒ–ãƒ­ãƒƒã‚¯è¨­å®šãŒã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã„ã„ã­ã‚„ãƒãƒ£ãƒƒãƒˆã¯ã§ãã¾ã›ã‚“ã€‚
            </div>
          {% else %}
            {% if me %}
              <a href="{% url 'send_like' profile.pk %}" class="btn-outline">
                {% if iine_sent %}
                  ğŸ‘ ã„ã„ã­æ¸ˆã¿
                {% else %}
                  ğŸ‘ ã“ã®äººã«ã„ã„ã­ã™ã‚‹
                {% endif %}
              </a>
            {% endif %}
            {% if can_chat %}
              <a href="{% url 'start_chat' profile.pk %}" class="btn-primary">
                ğŸ’¬ ã“ã®äººã¨ãƒãƒ£ãƒƒãƒˆã™ã‚‹
              </a>
            {% endif %}
          {% endif %}

        {% endif %}
      </div>

      {# ãƒ–ãƒ­ãƒƒã‚¯ / ãƒ–ãƒ­ãƒƒã‚¯è§£é™¤ãƒœã‚¿ãƒ³ï¼ˆè‡ªåˆ†ä»¥å¤–ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã ã‘ï¼‰ #}
      {% if me and profile.id != me.id %}
        <div class="profile-actions-row" style="margin-top:8px;">
          {% if blocked_by_me %}
            <a href="{% url 'unblock_user' profile.pk %}" class="btn-ghost">
              ğŸš« ãƒ–ãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã™ã‚‹
            </a>
          {% else %}
            <a href="{% url 'block_user' profile.pk %}" class="btn-ghost">
              ğŸš« ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹
            </a>
          {% endif %}
        </div>
      {% endif %}

      <div class="profile-footer-nav">
        <a href="{% url 'profile_list' %}" class="btn-ghost">â† ä¸€è¦§ã«æˆ»ã‚‹</a>
        <a href="/" class="btn-ghost">ãƒˆãƒƒãƒ—ã¸</a>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
(function() {
  const strip = document.getElementById("photo-strip");
  if (!strip) return;

  const slides = strip.querySelectorAll(".photo-slide");
  const arrows = document.querySelectorAll(".photo-arrow");
  if (slides.length <= 1) {
    arrows.forEach(btn => btn.style.display = "none");
    return;
  }

  let index = 0;

  function scrollToIndex(newIndex) {
    index = Math.max(0, Math.min(newIndex, slides.length - 1));
    const target = slides[index];
    strip.scrollTo({
      left: target.offsetLeft,
      behavior: "smooth"
    });
  }

  arrows.forEach(btn => {
    btn.addEventListener("click", function() {
      const dir = Number(this.dataset.direction || 1);
      scrollToIndex(index + dir);
    });
  });
})();
</script>
{% endblock %}
